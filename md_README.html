<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Recorder of Intel Realsense D435 camera &amp; Lidar: Package to display Intel realsense D435 topics to ROS allowing visualisation on rviz and record them in a replayable .bag file</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Recorder of Intel Realsense D435 camera &amp; Lidar
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Package to display Intel realsense D435 topics to ROS allowing visualisation on rviz and record them in a replayable .bag file </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This package allows to visialise as ROS topics the D435 camera streams (color, depth, filitred and/or colorized depth, pointclouds,...), recording them in the mean-time in a rosbag file, and replay them afterward. Post-processing filters and advanced-mode presets are configured in joined options_record.cfg and .json files.</p>
<p>The package uses the IntelRealSense librealsense2 library.</p>
<p>This package also depends on pcl library.</p>
<h2>Installation</h2>
<p>(Please check the Impovement section, as we found librairies allowing better performances that you may want to install before building the SDK library).</p>
<p>First install IntelRealSense libraries following <a href="https://github.com/IntelRealSense/realsense-ros">https://github.com/IntelRealSense/realsense-ros</a></p>
<p>For Ubuntu 20.04 using ROS Noetic, you have to dowload and build them from source : <a href="https://github.com/IntelRealSense/librealsense/releases">https://github.com/IntelRealSense/librealsense/releases</a></p><ul>
<li>Download .zip file and extract it where you want to install</li>
<li>Then build : <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cd librealsense-VERSION.zip</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;mkdir  build  &amp;&amp; cd build</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;cmake .. -DBUILD_EXAMPLES=true -DCMAKE_BUILD_TYPE=Release -DFORCE_LIBUVC=true</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;make -j1</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;sudo make install</div></div><!-- fragment --></li>
</ul>
<p>Then clone this package into your workspace and build it: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;mkdir my_workspace &amp;&amp; cd my_workspace</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;mkdir src &amp;&amp; cd src</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;git clone https://gitlab.irstea.fr/massyf/stage-bastien.git</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;cd..</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;catkin build</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;source devel/setup.bash</div></div><!-- fragment --><h3>Pre-configuration</h3>
<p>Now you have to change some desired parameters in the config_record.cfg, config_replay.cfg and config_visualise.cfg under the config folder. It is mandatory that you change the following parameters if you want the node to work :</p>
<ul>
<li>In the config_record.cfg file</li>
</ul>
<p>*serial_no : specify the serial number of the camera you are using.</p>
<p>*record_filepath : you can create a directory to save your bag file, for instance "bag_records". You need to specify the path here.</p>
<ul>
<li>In the config_replay.cfg file</li>
</ul>
<p>*replay_path : path of the directory where the records are saved.</p>
<p>*replay_filename : name of the .bag file you want to replay.</p>
<ul>
<li>In the config_visualise.cfg file</li>
</ul>
<p>*serial_no : specify the serial number of the camera you are using.</p>
<p>Others parameters are regarding auto exposure mode and presets configurations.</p>
<p>For more informations about .json presets please look here : <a href="https://github.com/IntelRealSense/librealsense/wiki/D400-Series-Visual-Presets">https://github.com/IntelRealSense/librealsense/wiki/D400-Series-Visual-Presets</a></p>
<p>An other filterParameters.cfg file runs with dynamic_reconfigure, to allow on the fly filters activation/desactivation and parameters changes. You can change them by running rqt_reconfigure, while the Realsense node is working. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;rosrun rqt_reconfigure rqt_reconfigure</div></div><!-- fragment --><p>For more information about filters settings please look here : <a href="https://dev.intelrealsense.com/docs/post-processing-filters">https://dev.intelrealsense.com/docs/post-processing-filters</a>.</p>
<h4>Usage</h4>
<p>Once the parameters in config files are set, you can execute in a terminal :</p>
<ul>
<li>To record <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;roslaunch record record.launch bag_filename_prefiw:=xxxxxxxx visualise:=true/false</div></div><!-- fragment --> -&gt; you can enter a bag_filename_prefix parameter if you want to add something in front of the .bag file name, otherwise it will just be named with the current time in the format "_AAAA-MM-DD-HH-MM-SS-MS.bag".</li>
</ul>
<p>-&gt; you can also choose to turn on the visualisation in RVIZ (off by default). Having it off allows the desactivation of unnecessary publisher and filters/pointcloud calculation, to lighten processor usage while writing the .bag file.</p>
<p>-&gt; frame transforms between the different frames are also specified in the launch file : *depth frame origin, tripod screw, back screw for the camera *lidar base frame, laser frame for the lidar</p>
<ul>
<li>To visualise only <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;roslaunch record visualise </div></div><!-- fragment --></li>
<li>To replay a record <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;roslaunch record replay</div></div><!-- fragment --> -&gt; you can also choose to turn on the visualisation in RVIZ (on by default). It just allows to launch rviz or not, but contrary to record, publishers are still on.</li>
</ul>
<h5>Code descprition</h5>
<p>The c++ code itself is documented with more details at : <a href="file:///home/bastien/inrae/record_camera/src/record/.gitignore/Doxygen/html/index.html">file:///home/bastien/inrae/record_camera/src/record/.gitignore/Doxygen/html/index.html</a></p>
<h6>Improvements</h6>
<p>As we were trying our package on a Rasberry Pi 4, we found on ACROBOTIC wiki a few solutions to improve performance as we faced some frame droping while recording the bag file. Please check their wiki here : (<a href="https://github.com/acrobotic/Ai_Demos_RPi/wiki/Raspberry-Pi-4-and-Intel-RealSense-D435">https://github.com/acrobotic/Ai_Demos_RPi/wiki/Raspberry-Pi-4-and-Intel-RealSense-D435</a>)</p>
<ul>
<li>Install protobuf — Google's language-neutral, platform-neutral, extensible mechanism for serializing structured data</li>
</ul>
<p>TODO : Change the "toolbox" to OOP. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
